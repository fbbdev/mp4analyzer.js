(function(){'use strict';var MP4={Compatibility:{},Tags:{},Atoms:{}};function proxyWebkitMethods(b){var a=/^webkit/;Object.getOwnPropertyNames(b.prototype).forEach(function(c){a.test(c)&&(b.prototype[c[6].toLowerCase()+c.slice(7)]=b.prototype[c])})}
function checkFileAPI(){window.Blob=window.Blob||window.webkitBlob||void 0;window.File=window.File||window.webkitFile||void 0;window.FileReader=window.FileReader||window.webkitFileReader||void 0;return Blob&&File&&FileReader?(proxyWebkitMethods(window.Blob),proxyWebkitMethods(window.File),proxyWebkitMethods(window.FileReader),!0):!1}function checkDataViewAPI(){window.DataView=window.DataView||window.webkitDataView||void 0;return DataView?(proxyWebkitMethods(window.DataView),!0):!1}
MP4.Compatibility={FileAPI:checkFileAPI,DataViewAPI:checkDataViewAPI};
MP4.Compatibility.FileAPI()&&MP4.Compatibility.DataViewAPI()?(Blob.prototype.pos=0,Blob.SEEK_SET=1,Blob.SEEK_CUR=2,Blob.SEEK_END=3,Blob.prototype.seek=function(b,a){a=a||Blob.SEEK_SET;a===Blob.SEEK_SET?this.pos=b:a===Blob.SEEK_CUR?this.pos+=b:a===Blob.SEEK_END&&(this.pos=this.size+b);this.pos=Math.min(Math.max(this.pos,0),this.size)},Blob.prototype.skip=function(b){this.pos+=b;this.pos>this.size&&(this.pos=this.size)},Blob.prototype.rewind=function(){this.pos=0},Blob.prototype.tell=function(){return this.pos},
Blob.prototype.eof=function(){return this.pos===this.size},Blob.prototype.poll=function(b){return this.slice(this.pos,this.pos+b)},Blob.prototype.read=function(b){b=this.poll(b);this.pos+=b.size;return b},MP4.Track=function(){this.codec=this.subtype=this.type=null},MP4.Context=function(){this.audio=this.video=this.currentTrack=this.parent=null;this.result=function(){return{video:this.video&&{codec:this.video.codec},audio:this.audio&&{codec:this.audio.codec}}}},MP4.Tags.Identifiers={ESDescriptor:3,
DecConfigDescriptor:4},MP4.Tags.ObjectTypes={64:"aac",102:"aac",103:"aac",104:"aac",105:".mp3",107:".mp3",165:"ac-3",169:"dts",221:"vorbis"},MP4.Tags.Descriptor=function(b,a){a=a||0;this.type=b.getUint8(a);this.size=0;this.headerSize=1;this.dataSize=0;for(var c=4;this.headerSize++,c--;){var d=b.getUint8(a+1+(3-c));this.size=this.size<<7|d&127;if(!(d&128))break}},MP4.Tags.ESDescriptor=function(b,a){a=a||0;MP4.Tags.Descriptor.call(this,b,a);if(this.type!==MP4.Tags.Identifiers.ESDescriptor)this.dataSize=
this.size-this.headerSize;else{a+=this.headerSize;this.dataSize=3;var c=b.getUint8(a+2);c&128&&(this.dataSize+=2);c&64&&(this.dataSize+=1+b.getUint8(a+this.dataSize));c&32&&(this.dataSize+=2)}},MP4.Tags.DecConfigDescriptor=function(b,a){a=a||0;MP4.Tags.Descriptor.call(this,b,a);this.type!==MP4.Tags.Identifiers.DecConfigDescriptor?(this.objectType=null,this.dataSize=this.size-this.headerSize):(a+=this.headerSize,this.objectType=b.getUint8(a),this.dataSize=13)},MP4.Atoms.Atom=function(b,a){a=a||0;this.size=
b.getUint32(a,!1);this.type=String.fromCharCode.apply(null,new Uint8Array(b.buffer,a+4,4));this.headerSize=8;this.dataSize=0;this.parsed=!1},MP4.Atoms.Atom.HeaderSize=8,MP4.Atoms.Map={},MP4.Atoms.visitChildren=function(b,a,c,d,f){a.skip(b.headerSize+b.dataSize);a.eof()?d(c):(f=f||new FileReader,f.onloadend=function(e){e.target.readyState===FileReader.DONE&&(e.target.result.byteLength<MP4.Atoms.Atom.HeaderSize?d(c):(e=new DataView(e.target.result),e=new MP4.Atoms.Atom(e,0),e.size<e.headerSize?d(c):
e.type in MP4.Atoms.Map&&MP4.Atoms.Map[e.type].visitor?(c.parent=b.type,MP4.Atoms.Map[e.type].visitor(e,a.read(e.size),c,function(b){a.eof()?d(c):f.readAsArrayBuffer(a.poll(MP4.Atoms.Atom.HeaderSize))})):(a.skip(e.size),a.eof()?d(c):f.readAsArrayBuffer(a.poll(MP4.Atoms.Atom.HeaderSize)))))},f.readAsArrayBuffer(a.poll(MP4.Atoms.Atom.HeaderSize)))},MP4.Atoms.visitor=function(b,a,c,d){if(b.type in MP4.Atoms.Map)if(b.parsed)MP4.Atoms.visitChildren(b,a,c,d);else if(MP4.Atoms.Map[b.type].parser){var f=
new FileReader;f.onloadend=function(e){e.target.readyState===FileReader.DONE&&(e=new DataView(e.target.result),b=MP4.Atoms.Map[b.type].parser(c,e,0),MP4.Atoms.visitChildren(b,a,c,d,f))};f.readAsArrayBuffer(a.poll(-1==MP4.Atoms.Map[b.type].parsedSize?b.size:MP4.Atoms.Map[b.type].parsedSize))}else b.dataSize=MP4.Atoms.Map[b.type].parsedSize-b.headerSize,MP4.Atoms.visitChildren(b,a,c,d);else d(c)},MP4.Atoms.HandlerReference=function(b,a){a=a||0;MP4.Atoms.Atom.call(this,b,a);var c=String.fromCharCode.apply(null,
new Uint8Array(b.buffer,a+12,8));this.componentType=c.slice(0,4);this.componentSubtype=c.slice(4);this.dataSize=this.size-this.headerSize;this.parsed=!0},MP4.Atoms.SampleDescription=function(b,a){a=a||0;MP4.Atoms.Atom.call(this,b,a);a+=12;this.entryCount=b.getUint32(a,!1);this.firstEntry=0<this.entryCount?String.fromCharCode.apply(null,new Uint8Array(b.buffer,a+8,4)):null;this.dataSize=8;this.parsed=!0},MP4.Atoms.MP4AMediaData=function(b,a){a=a||0;MP4.Atoms.Atom.call(this,b,a);this.dataSize=16;var c=
b.getUint16(a+16,!1);this.dataSize=0===c?this.dataSize+12:1===c?this.dataSize+28:2===c?this.dataSize+48:this.size-this.headerSize;this.parsed=!0},MP4.Atoms.ESDescriptor=function(b,a){a=a||0;MP4.Atoms.Atom.call(this,b,a);a+=12;this.dataSize=this.size-this.headerSize;var c=new MP4.Tags.ESDescriptor(b,a);a+=c.headerSize+c.dataSize;c=new MP4.Tags.DecConfigDescriptor(b,a);this.objectType=c.objectType;this.parsed=!0},MP4.Atoms.Map.moov={visitor:MP4.Atoms.visitor,parsedSize:MP4.Atoms.Atom.HeaderSize,parser:void 0},
MP4.Atoms.Map.trak={visitor:function(b,a,c,d){c.currentTrack=new MP4.Track;MP4.Atoms.visitChildren(b,a,c,function(a){"vide"===a.currentTrack.subtype&&null===a.video?a.video=a.currentTrack:"soun"===a.currentTrack.subtype&&null===a.audio&&(a.audio=a.currentTrack);a.currentTrack=null;d(a)})},parsedSize:MP4.Atoms.Atom.HeaderSize,parser:void 0},MP4.Atoms.Map.mdia={visitor:MP4.Atoms.visitor,parsedSize:MP4.Atoms.Atom.HeaderSize,parser:void 0},MP4.Atoms.Map.hdlr={visitor:function(b,a,c,d){"mdia"===c.parent?
MP4.Atoms.visitor(b,a,c,d):d(c)},parsedSize:MP4.Atoms.Atom.HeaderSize+12,parser:function(b,a,c){a=new MP4.Atoms.HandlerReference(a,c);b.currentTrack.type=a.componentType;b.currentTrack.subtype=a.componentSubtype;return a}},MP4.Atoms.Map.minf={visitor:MP4.Atoms.visitor,parsedSize:MP4.Atoms.Atom.HeaderSize,parser:void 0},MP4.Atoms.Map.stbl={visitor:MP4.Atoms.visitor,parsedSize:MP4.Atoms.Atom.HeaderSize,parser:void 0},MP4.Atoms.Map.stsd={visitor:MP4.Atoms.visitor,parsedSize:MP4.Atoms.Atom.HeaderSize+
16,parser:function(b,a,c){a=new MP4.Atoms.SampleDescription(a,c);0<a.entryCount&&"mp4a"!==a.firstEntry&&(b.currentTrack.codec=a.firstEntry,a.dataSize=a.size-a.headerSize);return a}},MP4.Atoms.Map.mp4a={visitor:function(b,a,c,d){"stsd"===c.parent?MP4.Atoms.visitor(b,a,c,d):d(c)},parsedSize:MP4.Atoms.Atom.HeaderSize+10,parser:function(b,a,c){return new MP4.Atoms.MP4AMediaData(a,c)}},MP4.Atoms.Map.wave={visitor:MP4.Atoms.visitor,parsedSize:MP4.Atoms.Atom.HeaderSize,parser:void 0},MP4.Atoms.Map.esds=
{visitor:MP4.Atoms.visitor,parsedSize:-1,parser:function(b,a,c){a=new MP4.Atoms.ESDescriptor(a,c);null!==a.objectType&&(b.currentTrack.codec=MP4.Tags.ObjectTypes[a.objectType]);return a}},MP4.analyze=function(b,a){if(!(b instanceof Blob))throw new TypeError("Invalid argument type");if("video/mp4"!=b.type&&"video/quicktime"!=b.type&&"audio/mp4"!=b.type)throw new TypeError("Input data format is not mp4/mov");var c=new ArrayBuffer(8),c=new DataView(c),c=new MP4.Atoms.Atom(c);c.size=MP4.Atoms.Atom.HeaderSize+
b.size;c.type="root";c.dataSize=-8;c.parsed=!0;MP4.Atoms.visitChildren(c,b,new MP4.Context,function(b){a(b.result())});return!0},window.MP4={supported:!0,analyze:MP4.analyze}):window.MP4={supported:!1,analyze:function(){return!1}};}());
